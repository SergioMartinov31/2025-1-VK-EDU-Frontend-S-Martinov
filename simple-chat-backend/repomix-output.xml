This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
data/
  chats.js
package.json
server.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="data/chats.js">
const getCurrTime = () => new Date().toLocaleTimeString()

// –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —á–∞—Ç–æ–≤
const initialChats = [
  {
    id: 0,
    name: 'Shrek',
    avatar: 'https://avatar.iran.liara.run/public/boy',
    unreadMessages: 99,
    messages: [
      {
        isOurs: false,
        text: 'hello1!jhgjhjh',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello2!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello3!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello4!',
        time: getCurrTime(),
      },
    ]
  },
  {
    id: 1,
    name: 'Donkey',
    avatar: 'https://avatar.iran.liara.run/public/boy',
    unreadMessages: 99,
    messages: [
      {
        isOurs: false,
        text: 'hello5!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello6!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello7!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello8!',
        time: getCurrTime(),
      },
    ]
  },
  {
    id: 2,
    name: 'Swamp',
    avatar: 'https://avatar.iran.liara.run/public/boy',
    unreadMessages: 228,
    messages: [
      {
        isOurs: false,
        text: 'hello!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello!',
        time: getCurrTime(),
      },
    ]
  },
  {
    id: 3,
    name: 'Fiona',
    avatar: 'https://avatar.iran.liara.run/public/girl',
    unreadMessages: 0,
    messages: [
      {
        isOurs: false,
        text: 'hello!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello!',
        time: getCurrTime(),
      },
      {
        isOurs: true,
        text: 'hello!',
        time: getCurrTime(),
      },
    ]
  },
]

let chats = [...initialChats];

// –ü–æ–ª—É—á–∏—Ç—å —á–∞—Ç—ã
const getChats = () => {
  // console.log('—ç—Ç–æ —è', chats)
  return chats;
};

const getChatsList = () => {
  return chats.map(chat => ({
    id: chat.id,
    name: chat.name,
    avatar: chat.avatar,
    unreadMessages: chat.unreadMessages,
    lastMessage: chat.messages.length > 0 
      ? chat.messages[chat.messages.length - 1]
      : { text: '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π', time: '00:00', isOurs: false }
  }));
};

// –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
const addMessageToChat = (id, text) => {
  const chat = chats.find(chatItem => chatItem.id === id);
  
  if (chat) {
    chat.messages.push({
      isOurs: true,
      text,
      time: getCurrTime(),
    });

    chat.unreadMessages += 1;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ localStorage
    console.log(`‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç ${id}: "${text}"`);
  }
  
  return getChats(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
};

const addMyVoiceMessageToChat = (id, voiceData) => {
  const chat = chats.find(chatItem => chatItem.id === id);
  
  if (chat) {
    chat.messages.push({
      isOurs: true,
      type: "voice", // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
      text: "[–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ]",
      // –í—ã–Ω–æ—Å–∏–º voiceMessageObj –Ω–∞ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å:
      voiceMessageObj: {  
        voice_text: voiceData.file,       // URL —Ñ–∞–π–ª–∞
        duration: voiceData.duration,
        mime: voiceData.mime || 'audio/webm'
      },
      time: getCurrTime(),
    });

    chat.unreadMessages += 1;
    console.log(`üé§ –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${voiceData.file}`);
  }
  
  return getChats();
};


const deleteMessageFromChat = (id, messageId) => {
  const chat = chats.find(chatItem => chatItem.id === id);
  
  if (chat) {
    chat.messages = chat.messages.filter((msg, index) => index !== messageId);

    console.log(`‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Å id ${messageId} —É–¥–∞–ª–µ–Ω–æ –∏–∑ —á–∞—Ç–∞ ${id}`);
  }
  
  return getChats(); 
}

const resetChats = () => {
  chats = [...initialChats];
  return getChats();
};

export {
  getChats,
  getChatsList, 
  addMessageToChat,
  addMyVoiceMessageToChat,
  deleteMessageFromChat,
  resetChats
};
</file>

<file path="package.json">
{
  "name": "simple-chat-backend",
  "version": "1.0.0",
  "description": "",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "node server.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "module",
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^5.1.0"
  }
}
</file>

<file path="server.js">
import multer from 'multer';
import path from 'path';
import fs from 'fs';


import express from 'express'; //–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã (GET, POST, PUT, DELETE)
import cors from 'cors'; // (Cross-Origin Resource Sharing) - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
import { getChats, getChatsList, addMessageToChat, addMyVoiceMessageToChat, deleteMessageFromChat} from './data/chats.js';

const app = express(); 
const PORT = 3001;

// ‚≠ê MIDDLEWARE - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à—Ç—É–∫–∏
app.use(cors()); // –†–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
app.use(express.json()); // –ü–æ–∑–≤–æ–ª—è–µ–º —á–∏—Ç–∞—Ç—å JSON –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞

const uploadDir = './uploads/voice';
if (!fs.existsSync(uploadDir)) {
  fs.mkdirSync(uploadDir, { recursive: true });
}

const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    cb(null, uploadDir);
  },
  filename: (req, file, cb) => {
    const ext = path.extname(file.originalname) || '.webm';
    cb(null, Date.now() + ext);
  }
});

const upload = multer({ storage });


app.get('/api/chats', (req, res) => {
  console.log('üì® –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ /api/chats');
  const chats = getChats();
  res.json(chats); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ
});

app.get('/api/chats-list', (req, res) => {
  console.log('üì® –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ /api/chats-list');
  const chatsList = getChatsList();
  res.json(chatsList);
});


app.post('/api/chats/:id/messages', (req, res) => {
  const chatId = parseInt(req.params.id);
  const { text } = req.body;
  
  console.log(`üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —á–∞—Ç–∞ ${chatId}: "${text}"`);
  
  const updatedChats = addMessageToChat(chatId, text);
  res.json({ success: true, chats: updatedChats });
});

app.post('/api/chats/:id/voice-upload', upload.single('voice'), (req, res) => {
  const chatId = parseInt(req.params.id);
  const file = req.file;
  const { duration } = req.body;

  if (!file) {
    return res.status(400).json({ error: '–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω' });
  }

  console.log(`üì• –ó–∞–≥—Ä—É–∂–µ–Ω —Ñ–∞–π–ª –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: ${file.filename}`);

  const fileUrl = `/uploads/voice/${file.filename}`;

  const updatedChats = addMyVoiceMessageToChat(chatId, {
    file: fileUrl,
    duration: Number(duration),
  });

  res.json({ success: true, chats: updatedChats });
});

app.use('/uploads', express.static('uploads'));



app.delete('/api/chats/:id/messages', (req, res) => {
  const chatId = parseInt(req.params.id);
  const { messageId } = req.body;

  console.log(`üì® –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è ${messageId} –∏–∑ —á–∞—Ç–∞ ${chatId}`);
  
  const updatedChats = deleteMessageFromChat(chatId, messageId);
  res.json({ success: true, chats: updatedChats });
});


app.listen(PORT, () => {
  console.log(`üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:${PORT}`);
  console.log('üì° –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:');
  console.log('   GET  http://localhost:3001/api/chats');
  console.log('   GET  http://localhost:3001/api/chats-list'); 
  console.log('   POST http://localhost:3001/api/chats/0/messages');
});
</file>

</files>
